<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>WebARフォトフレーム</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="versionInfo">IM_v2.1.5</div>

    <div class="container">
      <!-- カメラ映像 -->
      <video id="cameraFeed" autoplay playsinline></video>

      <!-- 撮影結果キャンバス（最初は非表示） -->
      <canvas id="photoCanvas" class="hidden"></canvas>

      <!-- スタンプ用キャンバス（Fabric.js／カメラの上、フレームの下） -->
      <canvas id="stampCanvas"></canvas>

      <!-- シャッターボタン（画像のみ） -->
      <button id="shutterButton" class="control-button" aria-label="写真を撮影する">
        <img id="shutterImage" src="./Assets/shutter_button.png" alt="シャッターボタン" />
      </button>

      <!-- スタンプボタン（シャッターの左） -->
      <button id="stampButton" class="control-button" aria-label="スタンプを選択する">
        <img src="./Assets/stamp_button.png" alt="スタンプアイコン" />
      </button>

      <!-- カメラ切り替えボタン（シャッターの右） -->
      <button id="cameraToggleButton" class="control-button" aria-label="カメラを切り替える">
        <img src="./Assets/change_button.png" alt="カメラ切り替えアイコン" />
      </button>

      <!-- カメラ許可メッセージ用モーダル -->
      <div id="permissionModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="permissionMessage">
        <div class="modal-content">
          <p id="permissionMessage">カメラへのアクセスを待機しています...</p>
          <button id="closeModalButton">OK</button>
        </div>
      </div>

      <!-- 撮影後のプレビューモーダル -->
      <div id="previewModal" class="modal hidden" aria-modal="true" role="dialog" aria-label="撮影プレビュー">
        <div class="preview-wrap">
          <button id="previewCloseX" class="preview-close" aria-label="プレビューを閉じる">×</button>
          <img id="previewImage" alt="撮影プレビュー画像" />
          <div class="preview-actions">
            <button id="previewSaveBtn" class="preview-btn primary">保存する</button>
            <button id="previewShareBtn" class="preview-btn">共有する</button>
            <button id="previewCloseBtn" class="preview-btn danger">閉じる</button>
          </div>
        </div>
      </div>

      <!-- フォトフレーム（見た目のオーバーレイ用） -->
      <img id="frameTop" src="./Assets/FYOP_AR_flame_top.png" alt="フォトフレーム上部" />
      <img id="frameBottom" src="./Assets/FYOP_AR_flame_bottom.png" alt="フォトフレーム下部" />

      <!-- 下から出る半透明のスタンプ選択シート -->
      <div id="stampSheet" class="stamp-sheet" role="dialog" aria-modal="true" aria-label="スタンプ選択">
        <div class="sheet-grip" aria-hidden="true"></div>

        <button id="sheetCloseX" class="sheet-close-x" aria-label="スタンプシートを閉じる">×</button>

        <!-- タブ見出し -->
        <div class="sheet-tabs" id="stampTabs" role="tablist" aria-label="スタンプカテゴリ">
          <button
            class="tab-btn"
            role="tab"
            aria-selected="false"
            aria-controls="panel-stamp1"
            id="tab-stamp1"
            data-tab="stamp1"
          >
            Stamp1
          </button>
          <button
            class="tab-btn active"
            role="tab"
            aria-selected="true"
            aria-controls="panel-stamp2"
            id="tab-stamp2"
            data-tab="stamp2"
          >
            Stamp2
          </button>
          <button
            class="tab-btn"
            role="tab"
            aria-selected="false"
            aria-controls="panel-stamp3"
            id="tab-stamp3"
            data-tab="stamp3"
          >
            Stamp3
          </button>
        </div>

        <!-- タブの中身 -->
        <div class="sheet-body">
          <!-- Stamp1 パネル -->
          <div
            class="stamp-panel"
            role="tabpanel"
            id="panel-stamp1"
            aria-labelledby="tab-stamp1"
            data-tab="stamp1"
          >
            <button class="stamp-thumb" data-src="./Assets/stamp019.png" aria-label="スタンプ 1-1">
              <img src="./Assets/stamp019.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp020.png" aria-label="スタンプ 1-2">
              <img src="./Assets/stamp020.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp018.png" aria-label="スタンプ 1-3">
              <img src="./Assets/stamp018.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp017.png" aria-label="スタンプ 1-4">
              <img src="./Assets/stamp017.png" alt="" />
            </button>
          </div>

          <!-- Stamp2 パネル -->
          <div
            class="stamp-panel active"
            role="tabpanel"
            id="panel-stamp2"
            aria-labelledby="tab-stamp2"
            data-tab="stamp2"
          >
            <button class="stamp-thumb" data-src="./Assets/stamp001.png" aria-label="スタンプ 2-1">
              <img src="./Assets/stamp001.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp002.png" aria-label="スタンプ 2-2">
              <img src="./Assets/stamp002.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp003.png" aria-label="スタンプ 2-3">
              <img src="./Assets/stamp003.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp004.png" aria-label="スタンプ 2-4">
              <img src="./Assets/stamp004.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp005.png" aria-label="スタンプ 2-5">
              <img src="./Assets/stamp005.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp006.png" aria-label="スタンプ 2-6">
              <img src="./Assets/stamp006.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp007.png" aria-label="スタンプ 2-7">
              <img src="./Assets/stamp007.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp008.png" aria-label="スタンプ 2-8">
              <img src="./Assets/stamp008.png" alt="" />
            </button>
          </div>

          <!-- Stamp3 パネル -->
          <div
            class="stamp-panel"
            role="tabpanel"
            id="panel-stamp3"
            aria-labelledby="tab-stamp3"
            data-tab="stamp3"
          >
            <button class="stamp-thumb" data-src="./Assets/stamp009.png" aria-label="スタンプ 3-1">
              <img src="./Assets/stamp009.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp010.png" aria-label="スタンプ 3-2">
              <img src="./Assets/stamp010.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp011.png" aria-label="スタンプ 3-3">
              <img src="./Assets/stamp011.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp012.png" aria-label="スタンプ 3-4">
              <img src="./Assets/stamp012.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp013.png" aria-label="スタンプ 3-5">
              <img src="./Assets/stamp013.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp014.png" aria-label="スタンプ 3-6">
              <img src="./Assets/stamp014.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp015.png" aria-label="スタンプ 3-7">
              <img src="./Assets/stamp015.png" alt="" />
            </button>
            <button class="stamp-thumb" data-src="./Assets/stamp016.png" aria-label="スタンプ 3-8">
              <img src="./Assets/stamp016.png" alt="" />
            </button>
          </div>
        </div>
      </div>

      <!-- スタンプ長押し用：フリックアクションダイヤル -->
      <div id="stampActionDial" class="hidden" aria-hidden="true">
        <button data-action="delete" class="dial-btn dial-right">削除</button>
        <button data-action="front" class="dial-btn dial-up">前面へ</button>
        <button data-action="back" class="dial-btn dial-down">背面へ</button>
        <button data-action="lock-toggle" class="dial-btn dial-left">ロック</button>
      </div>
    </div>

    <!-- Fabric.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>